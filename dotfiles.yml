# vim:ft=ansible:

- name: symlinks for all are present
  file:
    state: link
    dest: "{{ home_dir }}/.{{ item.name }}"
    src: "{{ dotfiles_dir }}/{{ item.dir|default('') }}{{ item.name }}"
  with_items:
    - {'name': 'vim'}
    - {'name': 'zshrc', 'dir': 'shell/'}
    - {'name': 'ideavimrc', 'dir': 'misc/'}

- name: symlinks for linux are present
  file:
    state: link
    dest: "{{ home_dir }}/{{ item.dest|default('.') }}{{ item.name }}"
    src: "{{ dotfiles_dir }}/linux/{{ item.name }}"
  with_items:
    - {'name': 'Xdefaults'}
    - {'name': 'xsessionrc'}
    - {'name': 'i3', 'dest': '.config/'}
  when: ansible_distribution == 'Ubuntu'

- name: i3_scripts is symlinked to ~/i3_scripts
  file:
    state: link
    dest: "{{ home_dir }}/i3_scripts"
    src: "{{ dotfiles_dir }}/linux/i3_scripts"
  when: ansible_distribution == 'Ubuntu'

- name: symlinks for osx are present
  file:
    state: link
    dest: "{{ home_dir }}/.{{ item.name }}"
    src: "{{ dotfiles_dir }}/{{ item.dir|default('') }}{{ item.name }}"
  with_items:
    - {'name': 'tmux.conf', 'dir': 'shell/'}
  when: ansible_distribution == 'MacOSX'

- name: virtualenvwrapper conf is added to .zsh.local
  lineinfile:
    dest: "{{ home_dir }}/.zsh.local"
    line:  "{{ item }}"
    state: present
    create: yes
  with_items:
    - "export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3"
    - "source ~/.local/bin/virtualenvwrapper.sh"
  when: ansible_distribution == 'Ubuntu'

- name: virtualenvwrapper conf is added to .zsh.local
  lineinfile:
    dest: "{{ home_dir }}/.zsh.local"
    line:  "{{ item }}"
    state: present
    create: yes
  with_items:
    - "export VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python3"
    - "source {{ home_dir }}/Library/Python/3.7/bin/virtualenvwrapper.sh"
  when: ansible_distribution == 'MacOSX'


- name: ~/.local/bin directory is present
  file:
    path: "{{ home_dir }}/.local/bin"
    state: directory
    recurse: yes

- name: scripts are symlinked to ~/.local/bin
  file:
    state: link
    dest: "{{ home_dir }}/.local/bin/{{ item }}"
    src: "{{ dotfiles_dir }}/scripts/{{ item }}"
  with_items:
    - git-cleanup-repo
