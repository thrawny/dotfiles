- name: symlinks for all are present
  file:
    state: link
    dest: "{{ home_dir }}/.{{ item.name }}"
    src: "{{ dotfiles_dir }}/{{ item.dir|default('') }}{{ item.name }}"
  with_items:
  - { "name": "vim", "dir": "config/" }
  - { "name": "zshrc", "dir": "config/zsh/" }
  - { "name": "ideavimrc", "dir": "config/jetbrains/" }
  - { "name": "gitconfig", "dir": "config/git/" }
  - { "name": "gitignoreglobal", "dir": "config/git/" }
  - { "name": "tmux.conf", "dir": "config/tmux/" }

# - name: "custom zsh theme is symlinked to .oh-my-zsh/custom"
#   file:
#     state: link
#     dest: "{{ home_dir }}/.oh-my-zsh/custom/{{ item }}"
#     src: "{{ dotfiles_dir }}/config/themes/{{ item }}"
#   with_items:
#   - thrawny.zsh-theme

- name: ~/.local/bin directory is present
  file:
    path: "{{ home_dir }}/.local/bin"
    state: directory
    recurse: yes

- name: Ensure Codex config exists (seed from example if missing/empty)
  vars:
    codex_dest: "{{ dotfiles_dir }}/config/codex/config.toml"
    codex_src: "{{ dotfiles_dir }}/config/codex/config.example.toml"
  block:
  - name: stat Codex config
    ansible.builtin.stat:
      path: "{{ codex_dest }}"
    register: codex_cfg
  - name: seed Codex config from example
    ansible.builtin.copy:
      src: "{{ codex_src }}"
      dest: "{{ codex_dest }}"
      remote_src: true
      mode: '0644'
    when: (not codex_cfg.stat.exists) or ((codex_cfg.stat.size | default(0)) | int == 0)

- name: Ensure Claude settings exist (seed from example if missing/empty)
  vars:
    claude_dest: "{{ dotfiles_dir }}/config/claude/settings.json"
    claude_src: "{{ dotfiles_dir }}/config/claude/settings.example.json"
  block:
  - name: stat Claude settings
    ansible.builtin.stat:
      path: "{{ claude_dest }}"
    register: claude_cfg
  - name: seed Claude settings from example
    ansible.builtin.copy:
      src: "{{ claude_src }}"
      dest: "{{ claude_dest }}"
      remote_src: true
      mode: '0644'
    when: (not claude_cfg.stat.exists) or ((claude_cfg.stat.size | default(0)) | int == 0)

- name: Ensure Cursor settings exist (seed from example if missing/empty)
  vars:
    cursor_dest: "{{ dotfiles_dir }}/config/cursor/settings.json"
    cursor_src: "{{ dotfiles_dir }}/config/cursor/settings.example.json"
  block:
  - name: stat Cursor settings
    ansible.builtin.stat:
      path: "{{ cursor_dest }}"
    register: cursor_cfg
  - name: seed Cursor settings from example
    ansible.builtin.copy:
      src: "{{ cursor_src }}"
      dest: "{{ cursor_dest }}"
      remote_src: true
      mode: '0644'
    when: (not cursor_cfg.stat.exists) or ((cursor_cfg.stat.size | default(0)) | int == 0)

- name: direnv config folder is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.config/direnv"
    src: "{{ dotfiles_dir }}/config/direnv"

- name: mise config folder is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.config/mise"
    src: "{{ dotfiles_dir }}/config/mise"

- name: ghostty config folder is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.config/ghostty"
    src: "{{ dotfiles_dir }}/config/ghostty"

- name: codex folder is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.codex"
    src: "{{ dotfiles_dir }}/config/codex"

- name: starship config is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.config/starship.toml"
    src: "{{ dotfiles_dir }}/config/starship/starship.toml"

- name: neovim config folder is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.config/nvim"
    src: "{{ dotfiles_dir }}/config/nvim"

- name: default npm packages
  file:
    path: "{{ home_dir }}/.default-npm-packages"
    src: "{{ dotfiles_dir }}/config/npm/default-packages"
    state: link

- name: ~/.claude directory is present
  file:
    path: "{{ home_dir }}/.claude"
    state: directory

- name: claude commands directory is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.claude/commands"
    src: "{{ dotfiles_dir }}/config/claude/commands"

- name: claude settings.json is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.claude/settings.json"
    src: "{{ dotfiles_dir }}/config/claude/settings.json"

- name: claude agents directory is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.claude/agents"
    src: "{{ dotfiles_dir }}/config/claude/agents"

- name: claude CLAUDE.md is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.claude/CLAUDE.md"
    src: "{{ dotfiles_dir }}/config/claude/CLAUDE-GLOBAL.md"

- name: claude skills directory is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.claude/skills"
    src: "{{ dotfiles_dir }}/config/claude/skills"

- name: ~/.config/ccstatusline directory is present
  file:
    path: "{{ home_dir }}/.config/ccstatusline"
    state: directory

- name: ccstatusline settings.json is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.config/ccstatusline/settings.json"
    src: "{{ dotfiles_dir }}/config/claude/ccstatusline-settings.json"

- name: k9s config folder is symlinked
  file:
    state: link
    dest: "{{ home_dir }}/.config/k9s"
    src: "{{ dotfiles_dir }}/config/k9s"
