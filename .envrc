# Bootstrap Nix features/caches for first switch on fresh machines.
export NIX_CONFIG="$(<"$PWD/nix/bootstrap-nix.conf")"

# Activate nix devshell if nix is installed and use_flake is available
if has nix && has use_flake; then
  if [[ -z "${DISPLAY:-}${WAYLAND_DISPLAY:-}" ]]; then
    # Headless - minimal shell without GTK
    use flake ./nix
  else
    # Desktop - include GTK for agent-switch
    use flake ./nix#desktop
  fi
fi

# Python environment via uv
layout uv
