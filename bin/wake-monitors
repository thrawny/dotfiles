#!/usr/bin/env bash
# Wake monitors that have trouble waking from sleep (especially LG monitors with NVIDIA)

LOG_FILE="${XDG_STATE_HOME:-$HOME/.local/state}/wake-monitors.log"

log() {
    local msg="[$(date '+%Y-%m-%d %H:%M:%S')] [wake-monitors] $*"
    echo "$msg"
    echo "$msg" >> "$LOG_FILE"
}

log "=== wake-monitors started (on-resume) ==="

# Cycle DPMS off and on to force monitors to wake
log "Toggling DPMS off..."
hyprctl dispatch dpms off
sleep 1
log "Toggling DPMS on..."
hyprctl dispatch dpms on

# If monitors still not awake, try a second cycle
sleep 0.5
if ! hyprctl monitors | grep -q "dpmsStatus: 1"; then
    log "Monitors still sleeping, trying again..."
    hyprctl dispatch dpms off
    sleep 0.5
    hyprctl dispatch dpms on
fi

log "=== wake-monitors finished ==="