#!/usr/bin/env bash
# Wake LG monitor after suspend/DPMS off
# LG 27GL850 wakes with backlight on but black screen - needs DPMS cycle
#
# Usage: wake-monitors-poll <source>
#   source: identifier for logging (e.g., "after-sleep", "on-resume")

set -euo pipefail

SOURCE="${1:-unknown}"
LG_MONITOR="HDMI-A-1"
LOG_FILE="${XDG_STATE_HOME:-$HOME/.local/state}/wake-monitors.log"

log() {
    local msg="[$(date '+%Y-%m-%d %H:%M:%S')] [wake-lg:${SOURCE}] $*"
    echo "$msg"
    echo "$msg" >>"$LOG_FILE"
}

main() {
    log "=== started ==="

    hyprctl dispatch dpms on

    # Wait for natural wake sequence (mouse/keyboard triggers monitor wake)
    # LG wakes with backlight but black screen - cycle DPMS to fix
    log "Waiting 5s for natural wake..."
    sleep 5

    log "Turning LG on again ($LG_MONITOR)..."
    hyprctl dispatch dpms on

    log "=== finished ==="
}

main "$@"
